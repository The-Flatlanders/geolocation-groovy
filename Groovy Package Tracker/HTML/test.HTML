<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Package Tracker</title>
	<style type="text/css">
	   div {
		}
      #map {
			height: 100%; 
			width:100%
			float:left;
      	}
      #controlPanel{
      		float:left;
			height:100%;
	  }
    </style>
</head>
<body>
	<div id="controlPanel">
	<div id="form">
		Package UUID:<br/><input id="idin" type="text" name="uuid"><br/>
  		<input type="button" value="Submit" onclick="exec()">
	</div>
	<ul>
		<li>123-01-203-120-3-</li>
	</ul>
	</div>
	<div id="map"></div>
	<script type="text/javascript">
		var map;
		function initMap(packages, midpointLat, midpointLon) {
			console.log(midpointLat + " " + midpointLon);
			var myLatlng = new google.maps.LatLng(midpointLat,midpointLon);
  			map = new google.maps.Map(document.getElementById('map'), {
   				center: myLatlng,
    			zoom: 8
  			});
		}
		function addPackage(lat1,lon1,lat2,lon2){
		var x=lat1;
		var y=lon1;
		var w=lat2;
		var z=lon2;
		  var flightPlanCoordinates = [];
		  flightPlanCoordinates.push(new google.maps.LatLng(x,y));
		  flightPlanCoordinates.push(new google.maps.LatLng(w,z));
			var flightPath = new google.maps.Polyline({
				path: flightPlanCoordinates,
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 1.0,
				strokeWeight: 2
			});
			flightPath.setMap(map);
		}
		
    </script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh8IK9eDqqGB8Wx2k0Vr_pcisZD1qw74A&callback=initMap">
    </script>
	<script language="javascript">
		xmlhttp=new XMLHttpRequest();	
		function exec()
		{
			var package;
			xmlhttp.onreadystatechange=
			function()
			{			
				if(xmlhttp.readyState ==4&& xmlhttp.status==200)
				{
				
					//Stores package information
					function packageInstance() {
   						this.lat = 0;
   						this.lon = 0;
   						this.dLat = 0;
   						this.dLon = 0;
					}
					
					function midpoint(){
						//midpoint stuff, all in lat and lon, minimizes/maximizes them initially
						this.leftEdge = 180; //lon
						this.rightEdge = -180; //lon
						this.topEdge = -90; //lat
						this.bottomEdge = 90; //lat
						this.checkBoundryLat = function(lat) {
        					if(lat < this.bottomEdge){
        						this.bottomEdge = lat;
        					}
        					if(lat > this.topEdge){
        						this.topEdge = lat;
        					}
  					 	};
  					 	this.checkBoundryLon = function(lon){
        					if(lon < this.leftEdge){
        						this.leftEdge = lon;
        					}
        					if(lon > this.rightEdge){
        						this.rightEdge = lon;
        					}
  					 	};
  					 	this.getMidpointLon = function(){
  					 		return ((leftEdge + rightEdge) / 2)
  					 	}
  					 	this.getMidpointLat = function(){
  					 		return ((topEdge + bottomEdge) / 2)
  					 	}
					}
					
					
					package=JSON.parse(xmlhttp.responseText);
					var packages = [];
					var currentPackage = new packageInstance();
					var packageMidpoint = new midpoint();
					
					for(var key in package){
						//old package is done, start a new one
						var val = parseInt(package.key);
						if(key.startsWith("locationLat")){
							currentPackage = new package();
							currentPackage.lat = val;
							packages.add(currentPackage);
							packageMidpoint.checkBoundryLat(val);
						}
						else if(key.startsWith("locationLon")){
							currentPackage.lon = val;
							packageMidpoint.checkBoundryLon(val);
						}
						else if(key.startsWith("desinationLat")){
							currentPackage.dLat = val;
							packageMidpoint.checkBoundryLat(val);
						}
						else if(key.startsWith("desinationLon")){
							currentPackage.dLon = val;
							packageMidpoint.checkBoundryLon(val);
						}
					}
					
				
					initMap(packages, packageMidpoint.getMidpointLat, packageMidpoint.getMidpointLon);
					for(var pack in packages){
						addPackage(package.lat,package.lon,package.dLat,package.dLon);
					}
				}
				else{
				}
			}
			var uuid=document.getElementById('idin').value;
			var params="uuid="+uuid;
			xmlhttp.open("POST", "http://localhost:8000/trackPackages",true);
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.setRequestHeader("Content-length", params.length);
			xmlhttp.setRequestHeader("Connection", "close");
			xmlhttp.setRequestHeader("Access-Control-Allow-Origin","*");
			xmlhttp.send(params);
		}
	</script>
</body>
</html>